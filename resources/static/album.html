<!DOCTYPE html>
<html lang="en">
<head>
    <title>Greeter</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="/static/pure.css">
    <link rel="stylesheet" href="/static/photoswipe.css">

    <script src="/static/jquery-3.6.3.min.js"></script>
    <script src="/static/client.js"></script>
    <script src="/static/photoswipe.umd.min.js"></script>
    <script src="/static/photoswipe-lightbox.umd.min.js"></script>
</head>
<body>

<div style="margin:2em">
    <h1 id="album-title">Album Title</h1>
    <div class="test-gallery"></div>
    <a id="album-dl" href="#">Download all photos (zip)</a>
</div>


<script>
    (function () {
        "use strict";
        var client = new Backend('');

        var path = window.location.pathname.split("/")
        var name = path[path.length - 2]

        $("#album-dl").attr("href", "/album/" + name + ".zip")

        client.getAlbumNameJson({
            name: name
        }, function (result) {
            console.log("OK", result)

            $('#album-title').html(result.album.title)
            document.title = result.album.title

            for (var i = 0; i < result.images.length; i++) {
                var img = result.images[i]

                var a = $("<a>")
                a.attr("href", "/images/" + img.hash + ".jpg")
                a.attr("data-pswp-width", 2500)
                a.attr("data-pswp-height", 1667)
                a.attr("target", "_blank")
                a.attr("data-pswp-srcset",
                    "/thumb/300w/" + img.hash + ".jpg 300w,\n" +
                    "/thumb/600w/" + img.hash + ".jpg 600w,\n" +
                    "/thumb/1200w/" + img.hash + ".jpg 1200w,\n" +
                    "/thumb/2400w/" + img.hash + ".jpg 2400w\n"
                )
                a.html('<img src="/thumb/300w/' + img.hash + '.jpg" srcset="/thumb/600w/' + img.hash + '.jpg 2x" />')

                $(".test-gallery").append(a)
            }

            var lightbox = new PhotoSwipeLightbox({
                gallery: '.test-gallery',
                children: 'a',
                // dynamic import is not supported in UMD version
                pswpModule: PhotoSwipe
            });
            lightbox.init();
        }, function (error) {

        }, function (error) {

        })
    })();
</script>
</body>
</html>